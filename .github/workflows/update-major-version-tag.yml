name: Update Major Version Tag

on:
  workflow_dispatch:
    inputs:
      major-version:
        description: "Major version number (e.g., 1)"
        required: true
        default: "1"

permissions:
  contents: write

jobs:
  update-tag:
    name: Update v${{ github.event.inputs.major-version }} tag
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/master'
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate input
        run: |
          if ! [[ "${{ github.event.inputs.major-version }}" =~ ^[0-9]+$ ]]; then
            echo "::error::major-version must be a positive integer"
            exit 1
          fi

      - name: Force-update major version tag
        env:
          MAJOR_VERSION: ${{ github.event.inputs.major-version }}
        run: |
          TAG="v${MAJOR_VERSION}"
          git tag -fa "${TAG}" -m "Point ${TAG} at $(git rev-parse --short HEAD)"
          git push --force origin "${TAG}"
          echo "Updated ${TAG} to $(git rev-parse HEAD)"
